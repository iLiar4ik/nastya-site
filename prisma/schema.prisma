// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  teacher
  student
}

enum PaymentStatus {
  pending
  paid
  overdue
}

enum LessonStatus {
  scheduled
  completed
  cancelled
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  name      String?
  role      UserRole @default(student)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  studentProfile Student?
  lessons        Lesson[]      @relation("TeacherLessons")
  payments       Payment[]
  homework       Homework[]
  materials      Material[]
  ogeTests       OGETest[]
  ogeMaterials   OGEMaterial[]
  performance    Performance[]
}

model Student {
  id        String   @id @default(cuid())
  userId    String   @unique
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  phone     String?
  parentName String?
  parentPhone String?
  notes     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  lessons     Lesson[]      @relation("StudentLessons")
  payments    Payment[]
  homework    Homework[]
  materials   Material[]
  ogeTests    OGETest[]
  performance Performance[]
}

model Lesson {
  id          String       @id @default(cuid())
  teacherId   String
  teacher     User         @relation("TeacherLessons", fields: [teacherId], references: [id], onDelete: Cascade)
  studentId   String
  student     Student      @relation("StudentLessons", fields: [studentId], references: [id], onDelete: Cascade)
  title       String?
  description String?
  startTime   DateTime
  endTime     DateTime
  status      LessonStatus @default(scheduled)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  @@index([teacherId])
  @@index([studentId])
  @@index([startTime])
}

model Payment {
  id          String        @id @default(cuid())
  userId      String
  user        User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  studentId   String
  student     Student       @relation(fields: [studentId], references: [id], onDelete: Cascade)
  amount      Float
  status      PaymentStatus @default(pending)
  description String?
  dueDate     DateTime?
  paidDate    DateTime?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  @@index([userId])
  @@index([studentId])
  @@index([status])
}

model Homework {
  id          String   @id @default(cuid())
  teacherId   String
  teacher     User     @relation(fields: [teacherId], references: [id], onDelete: Cascade)
  studentId   String
  student     Student  @relation(fields: [studentId], references: [id], onDelete: Cascade)
  title       String
  description String?
  fileUrl     String?
  dueDate     DateTime?
  completed   Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([studentId])
  @@index([teacherId])
}

model Material {
  id          String   @id @default(cuid())
  teacherId   String
  teacher     User     @relation(fields: [teacherId], references: [id], onDelete: Cascade)
  studentId   String?
  student     Student? @relation(fields: [studentId], references: [id], onDelete: Cascade)
  title       String
  description String?
  fileUrl     String
  isPublic    Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([studentId])
  @@index([teacherId])
}

model OGETest {
  id          String   @id @default(cuid())
  teacherId   String
  teacher     User     @relation(fields: [teacherId], references: [id], onDelete: Cascade)
  studentId   String
  student     Student  @relation(fields: [studentId], references: [id], onDelete: Cascade)
  testDate    DateTime
  score       Int?
  maxScore    Int      @default(100)
  subject     String?
  notes       String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([studentId])
  @@index([teacherId])
  @@index([testDate])
}

model OGEMaterial {
  id          String   @id @default(cuid())
  teacherId   String
  teacher     User     @relation(fields: [teacherId], references: [id], onDelete: Cascade)
  studentId   String?
  student     Student? @relation(fields: [studentId], references: [id], onDelete: Cascade)
  title       String
  description String?
  fileUrl     String
  isPublic    Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([studentId])
  @@index([teacherId])
}

model Performance {
  id          String   @id @default(cuid())
  teacherId   String
  teacher     User     @relation(fields: [teacherId], references: [id], onDelete: Cascade)
  studentId   String
  student     Student  @relation(fields: [studentId], references: [id], onDelete: Cascade)
  date        DateTime
  subject     String
  score       Float?
  maxScore    Float?
  notes       String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([studentId])
  @@index([teacherId])
  @@index([date])
}

