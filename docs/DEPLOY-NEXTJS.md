# Next.js: деплой и типичные ошибки

## Ошибка «Failed to find Server Action "x"»

В логах или в браузере после деплоя может появиться:

```
Failed to find Server Action "x". This request might be from an older or newer deployment.
```

### Причина

В Next.js 15 ID серверных действий зависят от ключа шифрования. При каждой новой сборке без фиксированного ключа эти ID меняются. Если пользователь держит открытой старую вкладку или кэш отдаёт старый JS, клиент шлёт старый ID — сервер его не находит.

### Решение

Задайте **постоянный** ключ шифрования и используйте его **и при сборке, и при запуске** (в одной и той же среде).

1. Сгенерируйте ключ (один раз):

   ```bash
   openssl rand -base64 32
   ```

2. В **Dokploy** (или вашей среде деплоя):
   - В настройках приложения откройте **Environment**.
   - Добавьте переменную:
     ```env
     NEXT_SERVER_ACTIONS_ENCRYPTION_KEY=<результат из шага 1>
     ```
   - Важно: эта переменная должна быть доступна **на этапе сборки (Build)**. В Dokploy переменные из Environment обычно передаются и в build, и в run. Если у вас сборка идёт отдельно (например, в CI), задайте ту же переменную и там.

3. Сделайте **полный передеплой** (Rebuild), чтобы новый билд собрался уже с этим ключом.

После этого ID серверных действий будут стабильными между деплоями, и ошибка «Failed to find Server Action» при открытых старых вкладках должна пропасть. Пользователям при необходимости достаточно обновить страницу (F5).
