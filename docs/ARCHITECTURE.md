# Архитектура: панель учителя и доступ учеников

## Где что находится

| Кто | URL | Описание |
|-----|-----|----------|
| **Учитель** | `/admin` | Вход в админку (email + пароль из `create-admin`). После входа: Ученики, Материалы, ДЗ, Тесты, Платежи. |
| Учитель | `/dashboard/*` | Дублирующий интерфейс (без проверки входа) — можно со временем убрать или защитить и оставить как «рабочий кабинет». |
| **Ученик** | `/student/*` | Личный кабинет: ДЗ, материалы, прогресс, расписание, чат. Сейчас **без входа** — данные не привязаны к конкретному ученику. |
| Ученик | `/auth` | Страница «Вход / Регистрация» — пока заглушка, логика не подключена. |

Ссылка на админку для учителя: кнопка **«Админка»** в шапке главной страницы и пункт «Админка» в сайдбаре дашборда.

---

## Рекомендуемая схема

### Одна панель для учителя
- **Использовать `/admin`** как единственную панель управления: ученики, материалы, ДЗ, тесты, платежи.
- По желанию: оставить `/dashboard` только для учителя (добавить проверку сессии и редирект с `/dashboard` в `/admin`) или убрать дублирование.

### Доступ учеников к личному кабинету

Нужно решить: вход **по коду** или **по логину (email + пароль)**.

#### Вариант 1: Доступ по коду (проще)
- В админке в карточке ученика: кнопка «Сгенерировать код доступа» / «Ссылка для ученика».
- Код (или ссылка вида `ваш-сайт.ru/student?code=XXXX`) привязан к `studentId`.
- Ученик открывает `/student` (или `/auth`), вводит код → создаётся сессия (cookie с `studentId` или токеном) → все страницы `/student/*` показывают только его ДЗ, материалы и т.д.
- Плюсы: не нужны пароли, легко выдать доступ одним кодом/ссылкой.

#### Вариант 2: Вход по email + паролю
- У каждого ученика в БД поле «пароль» (или «временный пароль»). Учитель задаёт его в админке или ученик меняет при первом входе.
- Страница `/auth` — реальный вход: проверка email + пароль по таблице учеников → сессия с `studentId` → редирект в `/student`.
- Плюсы: привычный логин, один пароль на всё.

#### Вариант 3: Оба способа
- Вход по коду (гостевая ссылка) и отдельно вход по email + пароль для «зарегистрированных» учеников.

---

## Что сделать в коде (кратко)

1. **Учитель**
   - Ничего не менять по URL: панель управления — по-прежнему `/admin`.
   - При желании: в `app/dashboard/layout.tsx` добавить проверку сессии учителя и редирект на `/admin` если не залогинен.

2. **Ученики — общая часть**
   - Завести сессию/куку для ученика (отдельно от учительской `admin_session`), например `student_session` с `studentId` или токеном.
   - Все API и страницы в `/student/*` должны брать данные только для этого `studentId` (фильтровать ДЗ, материалы и т.д.).

3. **Ученики — по коду**
   - В БД: поле у ученика `access_code` (уникальный код) или отдельная таблица одноразовых кодов.
   - API: `POST /api/student/login-by-code` (тело: `{ code }`) → проверка кода → выдача сессии ученика → ответ `{ ok: true }`.
   - Страница входа по коду: форма на `/auth` или `/student` с полем «Код доступа» → после успеха редирект в `/student/dashboard`.

4. **Ученики — по логину**
   - В БД: у ученика поля `email` + `password_hash` (или только пароль, если email уже есть).
   - API: `POST /api/student/login` (email + password) → проверка → сессия ученика.
   - Страница `/auth`: форма входа вызывает этот API, после успеха редирект в `/student`.

После этого панель управления для учителя остаётся на `/admin`, а ученики получают доступ к своему личному кабинету по коду или по логину — как вы решите.
