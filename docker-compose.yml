# Один образ, без PostgreSQL — SQLite в volume /app/data
# Образ собирается в GitHub Actions → ghcr.io/iliar4ik/nastya-site:latest
#
# Переменные в .env:
#   PAYLOAD_SECRET=ваш-секрет-32-символа
#   NEXT_PUBLIC_SERVER_URL=https://ваш-домен.ru
#   DATABASE_URL — по умолчанию file:/app/data/payload.db (можно не задавать)
services:
  app:
    image: ghcr.io/iliar4ik/nastya-site:latest
    pull_policy: always
    container_name: nastya-site-app
    restart: unless-stopped
    ports:
      - "8000:8000"
    environment:
      NODE_ENV: production
      DATABASE_URL: ${DATABASE_URL:-file:/app/data/payload.db}
      PAYLOAD_SECRET: ${PAYLOAD_SECRET}
      NEXT_PUBLIC_SERVER_URL: ${NEXT_PUBLIC_SERVER_URL}
      PAYLOAD_UPLOAD_DIR: ${PAYLOAD_UPLOAD_DIR:-/app/data/media}
    volumes:
      - payload_data:/app/data

volumes:
  payload_data:
