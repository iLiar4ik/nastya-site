# Сборка на Acer Aspire One даёт SIGILL (SWC/Atom CPU).
# Образ собирается в GitHub Actions → ghcr.io/iliar4ik/nastya-site:latest
# Dokploy: используйте Source "Docker Compose", образ будет загружен (не собран).
#
# Переменные: создайте файл .env в папке с docker-compose.yml на сервере
# (Dokploy загружает её при клонировании — добавьте .env вручную или через Dokploy Env).
# Формат .env:
#   DATABASE_URI=postgresql://user:password@postgres-host:5432/dbname
#   PAYLOAD_SECRET=ваш-секрет-32-символа
#   NEXT_PUBLIC_SERVER_URL=https://ваш-домен.ru
services:
  app:
    image: ghcr.io/iliar4ik/nastya-site:latest
    pull_policy: always
    container_name: nastya-site-app
    restart: unless-stopped
    ports:
      - "8000:8000"
    environment:
      NODE_ENV: production
      PAYLOAD_RUN_MIGRATIONS: "true"
      DATABASE_URI: ${DATABASE_URI}
      PAYLOAD_SECRET: ${PAYLOAD_SECRET}
      NEXT_PUBLIC_SERVER_URL: ${NEXT_PUBLIC_SERVER_URL}
      PAYLOAD_UPLOAD_DIR: ${PAYLOAD_UPLOAD_DIR:-/app/data/media}
    volumes:
      - payload_data:/app/data

volumes:
  payload_data:
